<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canadian Citizenship Tracker</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-card">
                    <div class="header-title">
                        <h1>üçÅ Canadian Citizenship Tracker üçÅ</h1>
                        <p>Track your progress towards Canadian citizenship eligibility</p>
                    </div>
                </div>
                <div class="header-actions">
                    <div id="authSection">
                        <!-- When not logged in -->
                        <div id="signInSection" class="auth-section">
                            <button class="btn btn-primary" id="signInBtn">
                                <i class="fas fa-cloud"></i> Save to Cloud
                            </button>
                        </div>
                        
                        <!-- When logged in -->
                        <div id="userSection" class="auth-section" style="display: none;">
                            <div class="user-info">
                                <div class="sync-status" id="syncStatus">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <span id="syncText">Synced</span>
                                </div>
                                <div class="user-details">
                                    <span id="userEmail">user@example.com</span>
                                    <button class="btn btn-secondary btn-small" id="shareBtn">
                                        <i class="fas fa-share"></i> Share
                                    </button>
                                    <button class="btn btn-secondary btn-small" id="signOutBtn">
                                        <i class="fas fa-sign-out-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <!-- Dashboard Section -->
            <section class="dashboard">
                <div class="stats-grid">
                    <div class="stat-card primary">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Days in Canada</h3>
                            <div class="stat-number" id="daysInCanada">0</div>
                            <div class="stat-subtitle">out of 1,095 required</div>
                        </div>
                    </div>

                    <div class="stat-card secondary">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Days Remaining</h3>
                            <div class="stat-number" id="daysRemaining">1095</div>
                            <div class="stat-subtitle">until eligibility</div>
                        </div>
                    </div>

                    <div class="stat-card accent">
                        <div class="stat-icon">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Progress</h3>
                            <div class="stat-number" id="progressPercent">0%</div>
                            <div class="stat-subtitle">towards goal</div>
                        </div>
                    </div>

                    <div class="stat-card info">
                        <div class="stat-icon">
                            <i class="fas fa-plane"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Total Trips</h3>
                            <div class="stat-number" id="totalTrips">0</div>
                            <div class="stat-subtitle">recorded</div>
                        </div>
                    </div>

                    <div class="stat-card warning">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-times"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Days Outside</h3>
                            <div class="stat-number" id="totalTripDays">0</div>
                            <div class="stat-subtitle">total trip days</div>
                        </div>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="progress-section">
                    <h3>Citizenship Progress</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                        <div class="progress-text" id="progressText">0 / 1,095 days</div>
                    </div>
                </div>

                <!-- Countdown -->
                <div class="countdown-section">
                    <h3>Estimated Eligibility Date</h3>
                    <div class="countdown" id="countdown">
                        <div class="countdown-item">
                            <span class="countdown-number" id="countdownDays">0</span>
                            <span class="countdown-label">Days</span>
                        </div>
                        <div class="countdown-item">
                            <span class="countdown-number" id="countdownHours">0</span>
                            <span class="countdown-label">Hours</span>
                        </div>
                        <div class="countdown-item">
                            <span class="countdown-number" id="countdownMinutes">0</span>
                            <span class="countdown-label">Minutes</span>
                        </div>
                        <div class="countdown-item">
                            <span class="countdown-number" id="countdownSeconds">0</span>
                            <span class="countdown-label">Seconds</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Navigation Tabs -->
            <nav class="tabs">
                <button class="tab-button active" data-tab="dashboard">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="tab-button" data-tab="trips">
                    <i class="fas fa-plane"></i> Trips
                </button>
                <button class="tab-button" data-tab="settings">
                    <i class="fas fa-cog"></i> Settings
                </button>
                <button class="tab-button" data-tab="data">
                    <i class="fas fa-database"></i> Data
                </button>
            </nav>

            <!-- Trips Section -->
            <section class="content-section" id="trips-section" style="display: none;">
                <div class="section-header">
                    <h2>Trip Management</h2>
                    <button class="btn btn-primary" id="addTripBtn">
                        <i class="fas fa-plus"></i> Add Trip
                    </button>
                </div>

                <div class="trips-list" id="tripsList">
                    <div class="empty-state">
                        <i class="fas fa-plane"></i>
                        <h3>No trips recorded yet</h3>
                        <p>Add your first trip to start tracking your time outside Canada</p>
                    </div>
                </div>

                <!-- Calculation Explanation -->
                <div class="calculation-explanation">
                    <h3>üßÆ How Your Eligibility is Calculated</h3>
                    <div class="explanation-grid">
                        <div class="explanation-card">
                            <h4>üìÖ 5-Year Eligibility Period</h4>
                            <p>Your eligibility is calculated based on the 5 years immediately before your application date. If you've been a permanent resident for less than 5 years, we use your PR date as the start.</p>
                        </div>
                        <div class="explanation-card">
                            <h4>üè† 1,095 Days Required</h4>
                            <p>You must be physically present in Canada for at least 1,095 days (3 years) during your 5-year eligibility period. This is the minimum requirement for citizenship.</p>
                        </div>
                        <div class="explanation-card">
                            <h4>‚úàÔ∏è Trip Calculations</h4>
                            <p>Each trip you record reduces your days in Canada. We calculate the exact overlap between your trips and your eligibility period to give you accurate numbers.</p>
                        </div>
                        <div class="explanation-card">
                            <h4>üéØ Days in Canada Formula</h4>
                            <p><strong>Days in Canada = Total Days in Eligibility Period - Days Outside Canada</strong><br>
                            Only trips that fall within your 5-year eligibility period are counted.</p>
                        </div>
                        <div class="explanation-card">
                            <h4>‚öñÔ∏è Official Requirements</h4>
                            <p>This calculator follows the official Government of Canada requirements. You must also have at least 730 days as a permanent resident within the 5-year period.</p>
                        </div>
                        <div class="explanation-card">
                            <h4>üí° Pro Tip</h4>
                            <p>The government recommends applying with more than 1,095 days to account for any calculation discrepancies. Aim for 1,200+ days for peace of mind!</p>
                        </div>
                    </div>
                    <div class="disclaimer">
                        <p><strong>‚ö†Ô∏è Disclaimer:</strong> This calculator provides estimates based on your input. Always verify your eligibility using the official Government of Canada Physical Presence Calculator before applying.</p>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section class="content-section" id="settings-section" style="display: none;">
                <div class="section-header">
                    <h2>Settings</h2>
                </div>

                <div class="settings-form">
                    <div class="form-group">
                        <label for="prDate">Permanent Resident Date</label>
                        <input type="date" id="prDate" class="form-input">
                        <small>The date you became a permanent resident of Canada</small>
                    </div>

                    <div class="form-group">
                        <label for="targetDate">Target Application Date</label>
                        <input type="date" id="targetDate" class="form-input">
                        <small>When you plan to apply for citizenship (optional)</small>
                    </div>

                    <div class="form-group">
                        <label for="residencyStatus">Current Status</label>
                        <select id="residencyStatus" class="form-input">
                            <option value="permanent">Permanent Resident</option>
                            <option value="temporary">Temporary Resident</option>
                            <option value="protected">Protected Person</option>
                        </select>
                    </div>

                    <div class="form-group residency-periods-group">
                        <div class="residency-periods-header">
                            <label>Residency Timeline (Last 5 Years)</label>
                            <button type="button" class="btn btn-secondary btn-small" id="addResidencyPeriodBtn">
                                <i class="fas fa-plus"></i> Add Period
                            </button>
                        </div>
                        <small class="helper-text">
                            Track each stretch of time in or out of Canada so we can calculate credits accurately. Choose
                            <strong>PR</strong> for permanent residence, <strong>Temporary</strong> for work/study/visitor status,
                            or <strong>Absence</strong> when you were outside Canada.
                        </small>
                        <small class="helper-text">
                            Temporary days count for half a day of credit (maximum 365 credited days). PR days count as full
                            days, while absences receive no credit.
                        </small>
                    </div>

                    <div class="residency-periods-card">
                        <div class="timeline-header">
                            <span>Start Date</span>
                            <span>End Date</span>
                            <span>Status</span>
                            <span></span>
                        </div>
                        <div id="residencyPeriodsContainer" class="timeline-body">
                            <div class="empty-state small-empty">
                                <i class="fas fa-calendar-plus"></i>
                                <p>Use ‚ÄúAdd Period‚Äù to record your residency history.</p>
                            </div>
                        </div>
                    </div>

                    <div class="info-callout">
                        <i class="fas fa-info-circle" aria-hidden="true"></i>
                        <p>
                            Only periods within the five years before your application date count toward eligibility. We‚Äôll
                            flag overlaps or dates outside that window so your calculation stays aligned with IRCC rules.
                        </p>
                    </div>

                    <button class="btn btn-primary" id="saveSettingsBtn">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>
            </section>

            <!-- Data Management Section -->
            <section class="content-section" id="data-section" style="display: none;">
                <div class="section-header">
                    <h2>Data Management</h2>
                </div>

                <div class="data-actions">
                    <!-- Cloud Sync Section -->
                    <div class="action-card cloud-sync" id="cloudSyncCard" style="display: none;">
                        <h3><i class="fas fa-cloud-upload-alt"></i> Cloud Sync</h3>
                        <p>Your data is automatically synced to the cloud when signed in</p>
                        <div class="sync-status" id="syncStatus">
                            <i class="fas fa-sync-alt"></i> <span>Ready to sync</span>
                        </div>
                        <button class="btn btn-primary" id="manualSyncBtn">
                            <i class="fas fa-sync"></i> Sync Now
                        </button>
                    </div>

                    <!-- Share Progress Section -->
                    <div class="action-card share-progress" id="shareProgressCard" style="display: none;">
                        <h3><i class="fas fa-share-alt"></i> Share Progress</h3>
                        <p>Create a public link to share your citizenship progress</p>
                        <button class="btn btn-success" id="shareProgressBtn">
                            <i class="fas fa-link"></i> Generate Share Link
                        </button>
                    </div>

                    <div class="action-card">
                        <h3><i class="fas fa-download"></i> Export Data</h3>
                        <p>Download your trip data and settings as a JSON file</p>
                        <button class="btn btn-secondary" id="exportBtn">Export Data</button>
                    </div>

                    <div class="action-card">
                        <h3><i class="fas fa-upload"></i> Import Data</h3>
                        <p>Upload a previously exported JSON file to restore your data</p>
                        <input type="file" id="importFile" accept=".json" style="display: none;">
                        <button class="btn btn-secondary" id="importBtn">Import Data</button>
                    </div>

                    <div class="action-card danger">
                        <h3><i class="fas fa-trash"></i> Clear All Data</h3>
                        <p>Remove all trips and settings (this cannot be undone)</p>
                        <button class="btn btn-danger" id="clearDataBtn">Clear All Data</button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Trip Modal -->
        <div class="modal" id="tripModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">Add Trip</h3>
                    <button class="modal-close" id="closeModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="tripForm">
                    <div class="form-group">
                        <label for="departureDate">Departure Date</label>
                        <input type="date" id="departureDate" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label for="returnDate">Return Date</label>
                        <input type="date" id="returnDate" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label for="destination">Destination</label>
                        <input type="text" id="destination" class="form-input" placeholder="e.g., United States, India, etc." required>
                    </div>

                    <div class="form-group">
                        <label for="reason">Reason for Travel</label>
                        <select id="reason" class="form-input" required>
                            <option value="">Select a reason</option>
                            <option value="vacation">Vacation/Tourism</option>
                            <option value="business">Business</option>
                            <option value="family">Family Visit</option>
                            <option value="medical">Medical</option>
                            <option value="education">Education</option>
                            <option value="emergency">Emergency</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group" id="otherReasonGroup" style="display: none;">
                        <label for="otherReason">Other Reason</label>
                        <input type="text" id="otherReason" class="form-input" placeholder="Please specify">
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="saveTripBtn">Save Trip</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Sign In Modal -->
        <div class="modal" id="signInModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Save Your Data to the Cloud</h3>
                    <button class="modal-close" id="closeSignInModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Sign in to save your citizenship tracking data to the cloud and access it from any device!</p>
                    
                    <div class="auth-options">
                        <button class="btn btn-primary auth-btn" id="googleSignInBtn">
                            <i class="fab fa-google"></i> Sign in with Google
                        </button>
                        
                        <div class="auth-divider">
                            <span>or</span>
                        </div>
                        
                        <div class="email-auth">
                            <div class="form-group">
                                <label for="emailInput">Email Address</label>
                                <input type="email" id="emailInput" class="form-input" placeholder="your@email.com">
                            </div>
                            <button class="btn btn-secondary auth-btn" id="emailSignInBtn">
                                <i class="fas fa-envelope"></i> Send Magic Link
                            </button>
                            <p class="auth-note">We'll send you a secure link to sign in - no password needed!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Share Modal -->
        <div class="modal" id="shareModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Share Your Progress</h3>
                    <button class="modal-close" id="closeShareModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Share your Canadian citizenship progress with others!</p>
                    
                    <div class="share-options">
                        <div class="form-group">
                            <label>Your Shareable Link:</label>
                            <div class="share-link-container">
                                <input type="text" id="shareLink" class="form-input" readonly>
                                <button class="btn btn-secondary" id="copyLinkBtn">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            </div>
                        </div>
                        
                        <div class="share-preview">
                            <h4>Preview of what others will see:</h4>
                            <div class="preview-card">
                                <h5>üçÅ Canadian Citizenship Progress</h5>
                                <div class="preview-stats">
                                    <div class="preview-stat">
                                        <strong id="previewDays">0</strong> days in Canada
                                    </div>
                                    <div class="preview-stat">
                                        <strong id="previewProgress">0%</strong> complete
                                    </div>
                                    <div class="preview-stat">
                                        <strong id="previewTrips">0</strong> trips recorded
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="share-note">
                            <p><i class="fas fa-info-circle"></i> Your personal trip details and dates are not shared - only your progress statistics.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Overlay -->
        <div class="overlay" id="overlay"></div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCPJXqFliu0bOCHr3FR-_IZX4SJ0brXZpE",
            authDomain: "citizenship-tracker-4a2c2.firebaseapp.com",
            projectId: "citizenship-tracker-4a2c2",
            storageBucket: "citizenship-tracker-4a2c2.firebasestorage.app",
            messagingSenderId: "1052062650855",
            appId: "1:1052062650855:web:ddf87d2dd9d4898ffced42",
            measurementId: "G-G00ZMYBL49"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDb = db;
    </script>
    <script src="firebase-auth.js"></script>
    <script src="firebase-sync.js"></script>
    <script src="script.js"></script>
</body>
</html>